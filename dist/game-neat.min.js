var Game=function(){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function l(t,e,n){return(l=u()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);i=new(Function.bind.apply(t,i));return n&&c(i,n.prototype),i}).apply(null,arguments)}function f(t){var i="function"==typeof Map?new Map:void 0;return(f=function(t){if(null===t||(e=t,-1===Function.toString.call(e).indexOf("[native code]")))return t;var e;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==i){if(i.has(t))return i.get(t);i.set(t,n)}function n(){return l(t,arguments,a(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),c(n,t)})(t)}function h(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function y(t,e){return v(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],i=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}return n}(t,e)||b(t,e)||g()}function d(t){return function(t){if(Array.isArray(t))return k(t)}(t)||p(t)||b(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t){if(Array.isArray(t))return t}function p(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function b(t,e){if(t){if("string"==typeof t)return k(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(t,e):void 0}}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function g(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}function t(e){var t=Object.keys(e),n=function(t){var e=t.alias,n=t.object;if(!(n instanceof Object))throw TypeError("Cannot register a non-object into DI!");{var i;Array.isArray(n)?(i=function(t){return v(t)||p(t)||b(t)||g()}(n),t=i[0],i=i.slice(1),this[e]=l(t,[this].concat(d(i)))):this[e]=new n(this)}}.bind(e),i=function(t){t=this[t];"function"==typeof t.onInit&&t.onInit(this)}.bind(e);return t.forEach(function(t){n({object:e[t],alias:t})}),t.forEach(i),{container:e,registerObject:n}}var w=[{axis:"x",side:"width"},{axis:"y",side:"height"}];function S(t,e){e.collisionList=t.filter(function(t){return t!==e&&(n=(t={gameObject:e,instance:t}).gameObject,i=t.instance,w.map(function(t){var e=t.axis,t=t.side;return n[e]>=i[e]-n.spriteDimensions[t]&&(n[e]<=i[e]+n.spriteDimensions[t]||i[e]+i.spriteDimensions[t]>=n[e])}).every(function(t){return t}));var n,i}),e.collisionList.length&&e.onCollision(e)}function e(){var h=this,y=this.gameObjectInstanceFactory.instances;Object.values(y).forEach(function(t){var i,o,r,e,n,s=t.x,a=t.y,c=t.sprite,u=t.spriteDimensions,l=u.width,f=u.height;n=(i=t).keyEvents,o=i.keyEventPressedKeys,r=i.keyUpEventPressedKeys,n.forEach(function(t){var e=t.key,n=t.callback,t=t.isKeyUp;(o.has(e)||t&&r.has(e))&&(n(i),r.delete(e))}),u=(e=t).horizontalSpeed,n=e.verticalSpeed,e.x+=u||0,e.y+=n||0,S(y,t),t.onRender(t),h.canvasContext.drawImage(c,s,a,l,f)})}function x(t){var e=t.strokeColor,n=t.fillColor,t=t.canvasContext;t.save(),e&&(t.strokeStyle=e),n&&(t.fillStyle=n)}function n(){r(this,n)}var C=new WeakMap,O=function(){function t(){r(this,t),C.set(this,{writable:!0,value:function(){}}),this.isRendering=!1}return s(t,[{key:"onInit",value:function(t){var e=t.gameObjectInstanceFactory,t=t.draw;this.gameObjectInstanceFactory=e,this.draw=t}},{key:"setCanvas",value:function(t){t=t instanceof HTMLCanvasElement?t:document.querySelector(t);if(!t)throw TypeError("Canvas hasn't been found. Check if parameter is a Element or valid selector.");return this.canvasContext=t.getContext("2d")}},{key:"setBackground",value:function(t){var e=t.backgroundUrl,n=t.backgroundColor,i=t.verticalSpeed,o=void 0===i?0:i,i=t.horizontalSpeed,t=void 0===i?0:i,i=this.canvasContext.canvas;e&&(i.style.backgroundImage='url("'.concat(e,'")'),i.style.backgroundSize="contain"),n&&(i.style.backgroundColor=n),this.bgVerticalSpeed=o,this.bgHorizontalSpeed=t}},{key:"startRender",value:function(){this.isRendering=!0,this.onRender()}},{key:"stopRender",value:function(){this.isRendering=!1}},{key:"setOnRenderCallback",value:function(t){var e,n,t=0<arguments.length&&void 0!==t?t:function(){};if("function"!=typeof t)throw TypeError((e="Parameter to {fnName} must a function, however type {type} was passed.",n={type:i(t),fnName:"setOnRenderCallback"},Object.keys(n).forEach(function(t){e=e.split("{".concat(t,"}")).join(n[t])}),e));!function(t,e,n){if(!(e=e.get(t)))throw new TypeError("attempted to set private field on non-instance");if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(this,C,t)}},{key:"onRender",value:function(){var t=this;this.isRendering&&requestAnimationFrame(function(){(function(){var t=this.canvasContext;t.clearRect(0,0,t.canvas.clientWidth,t.canvas.clientHeight)}).call(t),function(){var t=this.canvasContext,e=(o=this.draw.settings).font,n=o.fontSize,i=o.strokeColor,o=o.fillColor;t.font="".concat(n,"px ").concat(e,", sans-serif"),t.fillStyle=o,t.strokeStyle=i}.call(t),function(){var a=this.canvasContext;Object.values(this.draw.textList).forEach(function(t){var n=t.content,e=t.x,i=t.y,o=t.fill,r=t.data,s=t.strokeColor,t=t.fillColor;Object.entries(r).forEach(function(t){var e=y(t,2),t=e[0],e=e[1];n=n.split("{".concat(t,"}")).join(e)}),x({strokeColor:s,fillColor:t,canvasContext:a}),o&&a.fillText(n,e,i),a.strokeText(n,e,i),a.restore()})}.call(t),function(){var s=this.canvasContext;Object.values(this.draw.rectList).forEach(function(t){var e=t.x1,n=t.x2,i=t.y1,o=t.y2,r=t.fill;x({strokeColor:t.strokeColor,fillColor:t.fillColor,canvasContext:s}),r&&s.fillRect(e,i,n,o),s.strokeRect(e,i,n,o),s.restore()})}.call(t),e.call(t),function(){var t=this.canvasContext.canvas,e=(n=t.style).backgroundPositionY,n=n.backgroundPositionX,e=parseInt(e||0)+this.bgVerticalSpeed,n=parseInt(n||0)+this.bgHorizontalSpeed;t.style.backgroundPositionY=e+"px",t.style.backgroundPositionX=n+"px"}.call(t),function(t,e){if(!(e=e.get(t)))throw new TypeError("attempted to get private field on non-instance");return e.get?e.get.call(t):e.value}(t,C).call(t),t.onRender()})}}]),t}(),j=new WeakSet,E=new WeakSet,I=function(){function t(){r(this,t),E.add(this),j.add(this),this.x=0,this.y=0,this.keyEvents=[],this.spriteDimensions={},this.keyUpEventPressedKeys=new Set,this.keyEventPressedKeys=new Set}return s(t,[{key:"setPosition",value:function(t,e){this.x=t,this.y=e}},{key:"setRelativePosition",value:function(t,e){this.setPosition(this.x+t,this.y+e)}},{key:"setVerticalSpeed",value:function(t){this.verticalSpeed=t}},{key:"setHorizontalSpeed",value:function(t){this.horizontalSpeed=t}},{key:"setSpeed",value:function(t){this.setVerticalSpeed(t),this.setHorizontalSpeed(t)}},{key:"setSpriteDimensions",value:function(t,e){t=0<arguments.length&&void 0!==t?t:0,e=1<arguments.length&&void 0!==e?e:0;this.spriteDimensions.width=t,this.spriteDimensions.height=e}},{key:"setSprite",value:function(t,e){var n=this,i=1<arguments.length&&void 0!==e?e:{},e=i.widthMultiplier,o=void 0===e?1:e,i=i.heightMultiplier,r=void 0===i?1:i,s=new Image;return s.src=t,s.onload=function(){return n.setSpriteDimensions(s.naturalWidth*o,s.naturalHeight*r)},this.sprite=s}},{key:"isCollidingWith",value:function(e){return this.collisionList.some(function(t){return t===e||t.id===e})}},{key:"onCollision",value:function(){}},{key:"onRender",value:function(){}},{key:"onMouseMove",value:function(t){this.mouseMoveEvent=t}},{key:"onKey",value:function(t,e){var n=this;this.keyEvents.push({key:t,callback:e}),m(this,j,R).call(this,"keydown",t,function(){return n.keyEventPressedKeys.add(t)}),m(this,j,R).call(this,"keyup",t,function(){return n.keyEventPressedKeys.delete(t)})}},{key:"onKeyUp",value:function(t,e){var n=this;this.keyEvents.push({key:t,callback:e,isKeyUp:!0}),m(this,j,R).call(this,"keyup",t,function(){return n.keyUpEventPressedKeys.add(t)})}},{key:"isColliding",get:function(){return 0<this.collisionList.length}},{key:"isFreeXOnLeft",get:function(){var e=this;return m(this,E,L).call(this,function(t){return e.x<t.x})}},{key:"isFreeXOnRight",get:function(){var e=this;return m(this,E,L).call(this,function(t){return e.x>t.x})}},{key:"isFreeYOnTop",get:function(){var e=this;return m(this,E,L).call(this,function(t){return e.y<t.y})}},{key:"isFreeYOnBottom",get:function(){var e=this;return m(this,E,L).call(this,function(t){return e.y>t.y})}}]),t}(),R=function(t,e,n){document.body.addEventListener(t,function(t){t.key===e&&n(t)})},L=function(t){var e=this.collisionList;return 0<e.filter(t).length||0===e.length},P=function(){function t(){r(this,t)}return s(t,[{key:"onInit",value:function(t){t=t.gameObjectList;this.gameObjectList=t}},{key:"createObject",value:function(t,e){if(this.gameObjectList.hasOwnProperty(t)&&!e)throw Error("Game object with this id already exists.\nIf you want to create a new one with same id, pass true as a second parameter.");e=new I;return e.id=t,this.gameObjectList[t]=e}}]),t}(),T=new WeakSet,F=function(){function t(){r(this,t),T.add(this)}return s(t,[{key:"onInit",value:function(t){var e=t.gameObjectList,n=t.gameObjectInstanceList,t=t.scene;this.gameObjectList=e,this.instances=n,this.scene=t}},{key:"createInstance",value:function(t){var e=this.gameObjectList,n=this.instances,t=e[t];if(t instanceof I){t=m(this,T,A).call(this,t);return n.push(t),t}}}]),t}(),A=function(t){var e=this.scene.canvasContext.canvas,n=Object.create(t);return n.collisionList=[],"function"==typeof n.mouseMoveEvent&&e.addEventListener("mousemove",function(t){return n.mouseMoveEvent({instance:n,event:t})}),n},M=function(){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(o,f(Array));var n,i,e=(n=o,i=u(),function(){var t,e=a(n);return h(this,i?(t=a(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))});function o(){var t;return r(this,o),(t=e.call(this)).shift(),t}return s(o,[{key:"destroy",value:function(t){t=this.indexOf(t);return-1!==t&&(this.splice(t,1),!0)}},{key:"count",value:function(t){var n=t instanceof I?t.id:t;return this.reduce(function(t,e){return t+(e.id===n)},0)}},{key:"findInstancesBy",value:function(t){var e=t instanceof I?t.id:t;return this.filter(function(t){return t.id===e})}}]),o}(),z=function(i){return function(t){for(var e=0,n=this[i];void 0===t||n.hasOwnProperty(t)&&e<99999;)t=this.random.next(1,99999),++e;return t}},D=function(){function t(){r(this,t),this.settings={strokeColor:"#000",fillColor:"#000",fontSize:16,font:"Segoe UI"},this.textList={},this.rectList={},this.generateTextId=z("textList").bind(this),this.generateRectId=z("rectList").bind(this)}return s(t,[{key:"onInit",value:function(t){var e=t.scene,t=t.random;this.scene=e,this.random=t}},{key:"drawText",value:function(t){var e=t.content,n=t.x,i=t.y,o=t.fill,r=t.data,s=void 0===r?{}:r,a=t.strokeColor,r=t.fillColor,t=t.textId;return this.textList[t||this.generateTextId(t)]={content:e,x:n,y:i,fill:o,data:s,strokeColor:a,fillColor:r}}},{key:"drawRectangle",value:function(t){var e=t.x1,n=t.x2,i=t.y1,o=t.y2,r=t.fill,s=t.strokeColor,a=t.fillColor,t=t.rectId;return this.rectList[t||this.generateRectId(t)]={x1:e,x2:n,y1:i,y2:o,fill:r,strokeColor:s,fillColor:a}}},{key:"clearText",value:function(t){return delete this.textList[t]}},{key:"setFontSize",value:function(t){this.settings.fontSize=t}},{key:"setStrokeColor",value:function(t){this.settings.strokeColor=t}},{key:"setFillColor",value:function(t){this.settings.fillColor=t}},{key:"setStrokeAndFillColor",value:function(t){this.setStrokeColor(t),this.setFillColor(t)}},{key:"setFont",value:function(t){this.settings.font=t}}]),t}(),_=function(){function t(){r(this,t)}return s(t,[{key:"nextFloat",value:function(t,e){t=0<arguments.length&&void 0!==t?t:Number.MIN_SAFE_INTEGER,e=1<arguments.length&&void 0!==e?e:Number.MAX_SAFE_INTEGER;return t+Math.random()*(e-t)}},{key:"next",value:function(t,e){return Math.round(this.nextFloat(t,e))}}]),t}(),K=function(){function t(){r(this,t),this.sounds={}}return s(t,[{key:"addSound",value:function(t,e){this.sounds[t]=new Audio(e)}},{key:"playSound",value:function(t){this.sounds[t].play()}},{key:"stopSound",value:function(t){t=this.sounds[t];t.currentTime=0,t.pause()}},{key:"stopAllSounds",value:function(){Object.keys(this.sounds).forEach(this.stopSound.bind(this))}}]),t}();return function(){return t({draw:D,gameObjectFactory:P,gameObjectList:n,gameObjectInstanceList:M,gameObjectInstanceFactory:F,random:_,scene:O,sound:K}).container}}();
