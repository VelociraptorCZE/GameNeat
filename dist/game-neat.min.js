var Game=function(){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function n(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e,n){return(a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var o=[null];o.push.apply(o,e);var i=new(Function.bind.apply(t,o));return n&&r(i,n.prototype),i}).apply(null,arguments)}function l(t,e){return c(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var n=[],o=!0,i=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){i=!0,r=t}finally{try{o||null==s.return||s.return()}finally{if(i)throw r}}return n}(t,e)||f()}function s(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||u(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function c(t){if(Array.isArray(t))return t}function u(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function f(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function t(e){var t=Object.keys(e),n=function(t){var e=t.alias,n=t.object;if(!(n instanceof Object))throw TypeError("Cannot register a non-object into DI!");if(Array.isArray(n)){var o=function(t){return c(t)||u(t)||f()}(n),i=o[0],r=o.slice(1);this[e]=a(i,[this].concat(s(r)))}else this[e]=new n(this)}.bind(e),o=function(t){var e=this[t];"function"==typeof e.onInit&&e.onInit(this)}.bind(e);return t.forEach(function(t){n({object:e[t],alias:t})}),t.forEach(o),{container:e,registerObject:n}}function i(){var u=this;Object.values(this.gameObjectInstanceFactory.instances).forEach(function(t){var e,n,o,i,r,a,s=t.x,c=t.y,l=t.sprite;n=(e=t).keyEvents,o=e.pressedKeys,n.forEach(function(t){var e=t.key,n=t.callback;o.has(e)&&n()}),r=(i=t).horizontalSpeed,a=i.verticalSpeed,i.x+=r||0,i.y+=a||0,function(t){}.call(u,t),u.canvasContext.drawImage(l,s,c)})}function h(t){var e=t.strokeColor,n=t.fillColor,o=t.canvasContext;o.save(),e&&(o.strokeStyle=e),n&&(o.fillStyle=n)}function v(){e(this,v)}function y(o){return function(t){for(var e=0,n=this[o];void 0===t||n.hasOwnProperty(t)&&e<99999;)t=this.random.next(1,99999),++e;return t}}var d=function(){function t(){e(this,t),this.setOnRenderCallback(),this.isRendering=!1}return n(t,[{key:"onInit",value:function(t){var e=t.gameObjectInstanceFactory,n=t.draw;this.gameObjectInstanceFactory=e,this.draw=n}},{key:"setCanvas",value:function(t){var e=t instanceof HTMLCanvasElement?t:document.querySelector(t);if(!e)throw TypeError("Canvas hasn't been found. Check if parameter is a Element or valid selector.");return this.canvasContext=e.getContext("2d")}},{key:"setBackground",value:function(t){var e=t.backgroundUrl,n=t.backgroundColor,o=t.verticalSpeed,i=void 0===o?0:o,r=t.horizontalSpeed,a=void 0===r?0:r,s=this.canvasContext.canvas;e&&(s.style.backgroundImage='url("'.concat(e,'")'),s.style.backgroundSize="contain"),n&&(s.style.backgroundColor=n),this.bgVerticalSpeed=i,this.bgHorizontalSpeed=a}},{key:"startRender",value:function(){this.isRendering=!0,this.onRender()}},{key:"stopRender",value:function(){this.isRendering=!1}},{key:"setOnRenderCallback",value:function(t){var e=0<arguments.length&&void 0!==t?t:function(){};this._onRenderCallback=e}},{key:"onRender",value:function(){var t=this;this.isRendering&&requestAnimationFrame(function(){(function(){var t=this.canvasContext;t.clearRect(0,0,t.canvas.clientWidth,t.canvas.clientHeight)}).call(t),function(){var t=this.canvasContext,e=this.draw.settings,n=e.font,o=e.fontSize,i=e.strokeColor,r=e.fillColor;t.font="".concat(o,"px ").concat(n,", sans-serif"),t.fillStyle=r,t.strokeStyle=i}.call(t),function(){var c=this.canvasContext;Object.values(this.draw.textList).forEach(function(t){var i=t.content,e=t.x,n=t.y,o=t.fill,r=t.data,a=t.strokeColor,s=t.fillColor;Object.entries(r).forEach(function(t){var e=l(t,2),n=e[0],o=e[1];i=i.split("{".concat(n,"}")).join(o)}),h({strokeColor:a,fillColor:s,canvasContext:c}),o&&c.fillText(i,e,n),c.strokeText(i,e,n),c.restore()})}.call(t),function(){var a=this.canvasContext;Object.values(this.draw.rectList).forEach(function(t){var e=t.x1,n=t.x2,o=t.y1,i=t.y2,r=t.fill;h({strokeColor:t.strokeColor,fillColor:t.fillColor,canvasContext:a}),r&&a.fillRect(e,o,n,i),a.strokeRect(e,o,n,i),a.restore()})}.call(t),i.call(t),function(){var t=this.canvasContext.canvas,e=t.style,n=e.backgroundPositionY,o=e.backgroundPositionX;n=parseInt(n||0)+this.bgVerticalSpeed,o=parseInt(o||0)+this.bgHorizontalSpeed,t.style.backgroundPositionY=n+"px",t.style.backgroundPositionX=o+"px"}.call(t),t._onRenderCallback(),t.onRender()})}}]),t}(),k=function(){function t(){e(this,t),this.x=0,this.y=0,this.setObjectSize()}return n(t,[{key:"setPosition",value:function(t,e){this.x=t,this.y=e}},{key:"setRelativePosition",value:function(t,e){this.setPosition(this.x+t,this.y+e)}},{key:"setVerticalSpeed",value:function(t){this.verticalSpeed=t}},{key:"setHorizontalSpeed",value:function(t){this.horizontalSpeed=t}},{key:"setSpeed",value:function(t){this.setVerticalSpeed(t),this.setHorizontalSpeed(t)}},{key:"setObjectSize",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:0,o=1<arguments.length&&void 0!==e?e:0;this.width=n,this.height=o}},{key:"setSprite",value:function(t){var e=this,n=new Image;return n.src=t,n.onload=function(){return e.setObjectSize(n.naturalWidth,n.naturalHeight)},this.sprite=n}},{key:"onCollision",value:function(){}},{key:"onKeyEvent",value:function(t,e,n){document.body.addEventListener(t,function(t){t.key===e&&n(t)})}},{key:"onKey",value:function(t,e){var n=this.keyEvents,o=this.pressedKeys;n.push({key:t,callback:e}),this.onKeyEvent("keydown",t,function(){return o.add(t)}),this.onKeyEvent("keyup",t,function(){return o.delete(t)})}},{key:"onKeyDown",value:function(t,e){this.onKeyEvent("keydown",t,e)}},{key:"onKeyUp",value:function(t,e){this.onKeyEvent("keyup",t,e)}}]),t}(),b=function(){function t(){e(this,t)}return n(t,[{key:"onInit",value:function(t){var e=t.gameObjectList;this.gameObjectList=e}},{key:"createObject",value:function(t,e){if(this.gameObjectList.hasOwnProperty(t)&&!e)throw Error("Game object with this id already exists.\nIf you want to create a new one with same id, pass true as a second parameter.");var n=new k;return n.id=t,this.gameObjectList[t]=n}}]),t}(),g=function(){function t(){e(this,t),this.instances=[]}return n(t,[{key:"onInit",value:function(t){var e=t.gameObjectList;this.gameObjectList=e}},{key:"createInstance",value:function(t){var e=this.gameObjectList,n=this.instances,o=e[t];if(o instanceof k){var i=this.cloneObject(o);return n.push(i),i}}},{key:"cloneObject",value:function(t){var e=Object.assign(new k,t);return e.collisionList={},e.pressedKeys=new Set,e.keyEvents=[],e}}]),t}(),p=function(){function t(){e(this,t),this.settings={strokeColor:"#000",fillColor:"#000",fontSize:16,font:"Segoe UI"},this.textList={},this.rectList={},this.generateTextId=y("textList").bind(this),this.generateRectId=y("rectList").bind(this)}return n(t,[{key:"onInit",value:function(t){var e=t.scene,n=t.random;this.scene=e,this.random=n}},{key:"drawText",value:function(t){var e=t.content,n=t.x,o=t.y,i=t.fill,r=t.data,a=void 0===r?{}:r,s=t.strokeColor,c=t.fillColor,l=t.textId;return this.textList[l||this.generateTextId(l)]={content:e,x:n,y:o,fill:i,data:a,strokeColor:s,fillColor:c}}},{key:"drawRectangle",value:function(t){var e=t.x1,n=t.x2,o=t.y1,i=t.y2,r=t.fill,a=t.strokeColor,s=t.fillColor,c=t.rectId;return this.rectList[c||this.generateRectId(c)]={x1:e,x2:n,y1:o,y2:i,fill:r,strokeColor:a,fillColor:s}}},{key:"clearText",value:function(t){return delete this.textList[t]}},{key:"setFontSize",value:function(t){this.settings.fontSize=t}},{key:"setStrokeColor",value:function(t){this.settings.strokeColor=t}},{key:"setFillColor",value:function(t){this.settings.fillColor=t}},{key:"setStrokeAndFillColor",value:function(t){this.setStrokeColor(t),this.setFillColor(t)}},{key:"setFont",value:function(t){this.settings.font=t}}]),t}(),C=function(){function t(){e(this,t)}return n(t,[{key:"nextFloat",value:function(t,e){var n=0<arguments.length&&void 0!==t?t:Integer.MIN_SAFE_INTEGER,o=1<arguments.length&&void 0!==e?e:Integer.MAX_SAFE_INTEGER;return n+Math.random()*(o-n)}},{key:"next",value:function(t,e){return Math.round(this.nextFloat(t,e))}}]),t}();return function(){return t({draw:p,gameObjectFactory:b,gameObjectList:v,gameObjectInstanceFactory:g,random:C,scene:d}).container}}();
